<%= render partial: "layouts/page_title",
       locals: {title: "Locations",
       			subtitle: @location.description,
                backlink: home_path } %>

<div class="row">
  <div class="col-sm-8">

    <div class="panel panel-default">
      <div class="panel-body">
	    	<% data = get_site_coordinates(@location.sites) %>
				<%= render partial: 'shared/world_map_clickable', 
				   				 locals: { title: 'Sites',
				   			 	 data: data,
				   			 	 height: 300 } %>
			</div>
      <div class="panel-footer">
        <%= render 'location_dropdown' %>
      </div>
		</div>


    <div class="panel panel-default">
      <div class="panel-body">
	      <table class="table table-striped">
				  <% @location.publications.where(original_data: true)
				              .order('publication_year DESC, created_at DESC')
				              .each do |publication| %>
				    <%= render publication %>
				  <% end %>
				</table>
			</div>
		</div>
	</div>

  <div class="col-sm-4">
    
    <div class="panel panel-default">
      <div class="panel-heading">
        <strong>Research keywords</strong>
      </div>
      <div class="panel-body">
        <%= render partial: 'shared/wordcloud', 
                   locals: { title: 'location_publication_contents',
                   data: overall_publication_contents(@location.publications),
                   cut_off: 40, width: 400, height: 200 } %>
			</div>
		</div>

    <% if @location.publications.count > 0 %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>Researchers</strong> (that published on this location)
        </div>
        <div class="panel-body">        
          <%= render partial: 'shared/publication_authors', 
                     locals: { publication_authors: @location.publications } %>
        </div>
      </div>
    <% end %>

    <% if @location.photos.showcases_location.count > 0 %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>Photographs</strong> (from the field)
        </div>
        <div class="panel-body">
        <% @location.photos.showcases_location.each do |photo| %>
          <%= link_to image_tag(photo.image(:compo)), 
                      photo_path(photo) %><br>
        <% end %>
        </div>
      </div>
    <% end %>

    <% if @location.publications.count > 0 %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <strong>Publication summary</strong> (top 5 / category)
        </div>
        <div class="panel-body">        
          <%= render partial: 'location_keywords', 
                     locals: { publications: @location.publications } %>
        </div>
      </div>
    <% end %>

  </div>
</div>